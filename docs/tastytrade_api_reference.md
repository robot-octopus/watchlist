# tastytrade API Reference

This markdown document provides an LLM-readable overview of the Tastytrade API conventions, authentication mechanisms, and important domain concepts to assist with codebase integration.

---

## API Conventions (REST / JSON)

### Headers

- `User-Agent`: Required in the format `<product>/<version>` (e.g. `my-client/1.0`). Requests without it will be rejected.
- `Content-Type` and `Accept`: Must be `application/json`.

### Parameters

- JSON keys are **dasherized** in request and response bodies:
  ```json
  {
    "this-key-is-dasherized": "value goes here"
  }
  ```
- **GET**: Use query parameters.
  ```http
  ?my-key[]=value1&my-key[]=value2
  ```
- **POST/PUT/PATCH/DELETE**: Use JSON body:
  ```json
  POST /accounts/{account_number}/orders
  {
    "underlying-symbol": "AAPL",
    "quantity": 1,
    "time-in-force": "Day"
  }
  ```

### Response Schema

- Single object response:
  ```json
  {
    "data": { ... },
    "context": "/accounts/{account_number}/positions"
  }
  ```
- Multi-object response:
  ```json
  {
    "data": {
      "items": [ { ... }, { ... } ]
    },
    "context": "/some/context"
  }
  ```

### Error Format

```json
{
  "error": {
    "code": "not_permitted",
    "message": "User not permitted access"
  }
}
```

---

## Authentication

### Session Tokens

- Generated by `POST /sessions`
- Valid for 24 hours or until user logs out via `DELETE /sessions`
- Use as:
  ```http
  Authorization: <session_token>
  ```
- Do **not** prefix with `Bearer`

### OAuth2 Access Tokens

- Generated via `POST /oauth/token` using a registered OAuth client
- Valid for 15 minutes, must be refreshed
- Use as:
  ```http
  Authorization: Bearer <access_token>
  ```

---

## Symbology

### Equities

- Examples: `AAPL`, `BRK/A`

### Equity Options

- Format: `<ROOT><YYMMDD><P/C><STRIKE>`
  - Root: 6-character padded
  - Date: yymmdd
  - Type: `P` or `C`
  - Strike: 8-digit integer (strike \* 1000)
- Example:
  ```
  AAPL 220617P00150000 // AAPL Put, June 17 2022, $150
  ```

### Futures

- Format: `/<PRODUCT><MONTH><YEAR>`
  - E.g. `/ESZ2` (E-mini S&P 500 Dec 2022)

### Future Options

- Format:
  ```
  ./<FUT_CONTRACT> <OPTION_PRODUCT> <EXP_DATE><P/C><STRIKE>
  ```
- Example:
  ```
  ./CLZ2 LO1X2 221104C91 // Crude Oil Weekly, Call at 91, Exp. Nov 4 2022
  ```

### Cryptocurrencies

- Found via `GET /instruments/cryptocurrencies`
- Examples:
  - `BTC/USD`
  - `ETH/USD`

---

## Error Codes

| Code | Description                                  |
| ---- | -------------------------------------------- |
| 400  | Invalid request body or parameters           |
| 401  | Unauthorized (invalid or expired token)      |
| 403  | Forbidden (not permitted to access resource) |
| 404  | Resource not found                           |
| 422  | Unprocessable action, invalid in context     |
| 429  | Too many requests (rate-limited)             |
| 500  | Server error (includes support identifier)   |

---

## High-Level Concepts

### Orders

- Max 4 legs per order
- Each leg includes:
  - `symbol`, `quantity`, `action`
- Actions:
  - `Buy to Open`, `Sell to Close`, `Sell to Open`, `Buy to Close`
- Example: Buy 100 AAPL
  ```json
  {
    "symbol": "AAPL",
    "quantity": 100,
    "action": "Buy to Open"
  }
  ```

### Positions

- Created/adjusted on fill
- Direction: Long or Short
- Cannot be both long & short simultaneously

### Accounts

- Each endpoint operates on one account
- Cannot order across accounts in one request

### Trading Status

- Grants permissions (e.g., crypto trading, advanced options strategies)

### Balances

- Includes cash, buying power, NLV (net liquidating value), and more

### Transactions

- Tracks all events that affect balance: fills, dividends, fees, etc.

### Instruments

- Tradable entities (stocks, options, futures, crypto)
- Identified by symbol, used in orders/positions

---

## Sample Order Request

```json
POST /accounts/{account_number}/orders
{
  "underlying-symbol": "TSLA",
  "quantity": 2,
  "time-in-force": "GTC",
  "order-type": "Limit",
  "price": 710.00,
  "action": "Buy to Open"
}
```

---

## Notes for LLM Usage

- Always include a valid `User-Agent` and `Content-Type: application/json`
- Use dasherized parameter names
- Refresh tokens before expiry or re-authenticate using sessions
- Ensure the trading status allows required privileges before submitting trades

---

## Resources

- [Account Balances API Guide](#)
- [Order Submission API Guide](#)
- [Instruments API Guide](#)
- [OAuth2 API Guide](#)
- [Error Handling Reference](#)

This file serves as a machine-parsable specification for use in LLM environments and AI-based code generation systems targeting the tastytrade API.

